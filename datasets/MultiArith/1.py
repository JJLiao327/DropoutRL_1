import json

def convert_json_to_jsonl(input_file, output_file):
    """
    Converts a JSON file (containing a single object or a list of objects)
    to a JSONL file with a new format.

    The transformation logic is:
    - 'question' field is copied directly.
    - 'final_ans' is used to create a new 'answer' field in the format:
      "#### [final_ans]".
      Note: The detailed reasoning part is not in the source data and
      is not generated by this script.
    """
    try:
        with open(input_file, 'r', encoding='utf-8') as infile:
            data = json.load(infile)
    except FileNotFoundError:
        print(f"Error: Input file '{input_file}' not found.")
        return
    except json.JSONDecodeError:
        print(f"Error: Could not decode JSON from '{input_file}'.")
        return

    # 如果输入文件只包含一个JSON对象，则将其放入列表中以便统一处理
    if not isinstance(data, list):
        data = [data]

    with open(output_file, 'w', encoding='utf-8') as outfile:
        for entry in data:
            # 检查必要的键是否存在
            if 'question' not in entry or 'final_ans' not in entry:
                print(f"Skipping an entry due to missing 'question' or 'final_ans': {entry}")
                continue

            # 创建新的格式
            # 注意：这里的 answer 字段只包含最终答案的格式化字符串。
            # 完整的解题步骤需要手动添加或通过其他方式生成。
            # 例如: reasoning = "Some reasoning steps..."
            reasoning = "" # 将解题步骤留空
            final_answer_str = entry['final_ans']
            
            # 组合成最终的 answer 字符串
            # 如果有推理步骤，可以像这样组合: f"{reasoning}\n#### {final_answer_str}"
            # 这里我们只使用 final_ans
            answer_content = f"{final_answer_str}"

            new_entry = {
                "question": entry['question'].strip(), # 使用strip()去除首尾多余的空格
                "answer": answer_content 
            }

            # 将转换后的字典写入JSONL文件
            outfile.write(json.dumps(new_entry) + '\n')

    print(f"Successfully converted '{input_file}' to '{output_file}'.")

# --- 主程序 ---
if __name__ == "__main__":
    input_filename = 'test.json'
    output_filename = 'converted_test.jsonl'
    convert_json_to_jsonl(input_filename, output_filename)

